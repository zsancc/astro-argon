---
import { Icon } from "astro-icon/components";
import I18nKey from "../../i18n/i18nKey";
import { i18n } from "../../i18n/translation";

interface Props {
	id: string;
	name?: string;
	nameClass?: string;
	isCollapsed?: boolean;
	scrollable?: boolean;
	collapsedHeight?: string;
	class?: string;
	style?: string;
}
const { id, name, nameClass = "text-90", isCollapsed, scrollable = false, collapsedHeight, style } =
	Astro.props;
const className = Astro.props.class;
---
<widget-layout
	data-id={id}
	data-is-collapsed={String(isCollapsed)}
	class={"card card-compact widget-shell pb-4 " + className}
	style={style}
>
    <div class:list={[
        "widget-title",
        nameClass,
    ]}>{name}</div>
    <div
        id={id}
        class:list={[
            "collapse-wrapper px-4 overflow-hidden",
            { "collapsed": isCollapsed && !scrollable },
            { "max-h-56 overflow-y-auto hide-scrollbar": isCollapsed && scrollable },
        ]}
    >
        <slot></slot>
    </div>
    {isCollapsed && !scrollable && <div class="expand-btn px-4 -mb-2">
        <button class="btn btn-ghost btn-sm widget-expand-btn-skin">
            <div class="widget-expand-inner">
                <Icon name="material-symbols:more-horiz" class="text-[1.75rem]"></Icon> {i18n(I18nKey.more)}
            </div>
        </button>
    </div>}
</widget-layout>

<style define:vars={{ collapsedHeight }}>
    .collapsed {
        height: var(--collapsedHeight);
    }
</style>

<script>
    class WidgetLayout extends HTMLElement {
        constructor() {
            super();

            if (this.dataset.isCollapsed !== "true")
                return;

            const id = this.dataset.id;
            const btn = this.querySelector('.expand-btn');
            const wrapper = id ? this.querySelector(`#${id}`) : null;
            if (!(btn instanceof HTMLElement) || !(wrapper instanceof HTMLElement)) {
                return;
            }
            btn.addEventListener('click', () => {
                wrapper.classList.remove('collapsed');
                btn.classList.add('hidden');
            });
        }
    }

    if (!customElements.get("widget-layout")) {
        customElements.define("widget-layout", WidgetLayout);
    }
</script>
